<!DOCTYPE html>
<html lang="en-us">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta itemprop="name" content="desmo" />
  <meta itemprop="description" content="Random Ideas" />

  <link rel="apple-touch-icon" sizes="180x180" href="https://desmodrone.github.io/apple-touch-icon.png"/>
  <link rel="icon" type="image/png" sizes="32x32" href="https://desmodrone.github.io/favicon-32x32.png" />
  <link
    rel="icon"
    type="image/png"
    sizes="16x16"
    href="https://desmodrone.github.io/favicon-16x16.png"
  />
  <link
    rel="shortcut icon"
    href="https://desmodrone.github.io/favicon.ico"
  />
  <link rel="stylesheet" href="https://desmodrone.github.io/style.css"/>
  
  <title>24 Rustlings Macros Solution</title>
  

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://desmodrone.github.io/rss.xml">
  

  <body id="page">

	
<header id="site-header" class="animated slideInUp faster">
  <div class="hdr-wrapper section-inner">
    <div class="hdr-left">
      <div class="site-branding">
        <a href="https:&#x2F;&#x2F;desmodrone.github.io">desmo</a>
      </div>
      <nav class="site-nav hide-in-mobile">
            
        
        <a href="https://desmodrone.github.io/posts">posts</a>
        
        <a href="https://desmodrone.github.io/about">about</a>
        
        <a href="https://desmodrone.github.io/work">work</a>
        
      </nav>
    </div>
    <div class="hdr-right hdr-icons">
      <span class="hdr-social hide-in-mobile">
        

<a href="https:&#x2F;&#x2F;twitter.com&#x2F;desmo_io" target="_blank" rel="noopener me"
   title="twitter">
  
  <svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
  
</a>

<a href="https:&#x2F;&#x2F;github.com&#x2F;desmodrone" target="_blank" rel="noopener me"
   title="github">
  
  <svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
  
</a>

<a href="mailto:erick@apexwins.com" target="_blank" rel="noopener me"
   title="email">
  
  <svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
  
</a>


      </span>
      <button id="menu-btn" class="hdr-btn" title="Menu">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="feather feather-menu"
        >
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>
</header>
<div id="mobile-menu" class="animated fast">
  <ul>
    
    <li><a href="https://desmodrone.github.io/posts">posts</a></li>
    
    <li><a href="https://desmodrone.github.io/about">about</a></li>
    
    <li><a href="https://desmodrone.github.io/work">work</a></li>
    
  </ul>
</div>

	
	

		
<main class="site-main section-inner animated fadeIn faster">
  <article class="thin">
	<header class="post-header">
	  <div class="post-meta">
		
		<span>Nov 21, 2023</span>
		<small> - 
<span class="reading-time" title="Estimated read time">
  
  4 min read
  
</span>
</small>
		
            
	  </div>
	  <h1>24 Rustlings Macros Solution</h1>
	</header>

	<div class="content">
        
	  <p>Rust's macro system is very powerful, but also kind of difficult to wrap your
head around. We're not going to teach you how to write your own fully-featured
macros. Instead, we'll show you how to use and create them.</p>
<p>If you'd like to learn more about writing your own macros, the
<a href="https://github.com/tfpk/macrokata">macrokata</a> project has a similar style
of exercises to Rustlings, but is all about learning to write Macros.</p>
<h2 id="further-information">Further information</h2>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch19-06-macros.html">Macros</a></li>
<li><a href="https://veykril.github.io/tlborm/">The Little Book of Rust Macros</a></li>
</ul>
<h2 id="macros1-rs">Macros1.rs</h2>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">&#x2F;&#x2F; macros1.rs
&#x2F;&#x2F; Execute `rustlings hint macros1` or use the `hint` watch subcommand for a hint.

&#x2F;&#x2F; I AM NOT DONE

macro_rules! my_macro {
    () =&gt; {
        println!(&quot;Check out my macro!&quot;);
    };
}

fn main() {
    my_macro();
}
</code></pre>
<p>This looks like a fairly simple exercise using Macros, let's take a look at the errors.</p>
<h2 id="macros1-rs-errors">Macros1.rs Errors</h2>
<p>The Rust compiler tells us directly what the problem is, we're missing the <code>!</code> symbol to call our macro, just like we do for <code>println!</code></p>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">error[E0423]: expected function, found macro `my_macro`
  --&gt; exercises&#x2F;macros&#x2F;macros1.rs:13:5
   |
13 |     my_macro();
   |     ^^^^^^^^ not a function
   |
help: use `!` to invoke the macro
   |
13 |     my_macro!();
   |             +

error: aborting due to previous error; 1 warning emitted
</code></pre>
<h2 id="macros1-rs-solution">Macros1.rs Solution</h2>
<p>Following the instructions from the compiler message and simply adding the <code>!</code> to our calling of <code>my_macro</code></p>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">macro_rules! my_macro {
    () =&gt; {
        println!(&quot;Check out my macro!&quot;);
    };
}

fn main() {
    my_macro!();  &#x2F;&#x2F; adding `!` here
}
</code></pre>
<p>With that we have our code compiling and first macro exercise done.
Output:</p>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">‚úÖ Successfully ran exercises&#x2F;macros&#x2F;macros1.rs!

üéâ üéâ  The code is compiling! üéâ üéâ

Output:
====================
Check out my macro!

====================
</code></pre>
<h2 id="macros2-rs">Macros2.rs</h2>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">&#x2F;&#x2F; macros2.rs
&#x2F;&#x2F; Execute `rustlings hint macros2` or use the `hint` watch subcommand for a hint.

&#x2F;&#x2F; I AM NOT DONE

fn main() {
    my_macro!();
}

macro_rules! my_macro {
    () =&gt; {
        println!(&quot;Check out my macro!&quot;);
    };
}
</code></pre>
<p>This one doesn't give us any instruction but we can see the code is not compiling. Let's look at the errors.</p>
<h2 id="macros2-rs-errors">Macros2.rs Errors</h2>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust"> --&gt; exercises&#x2F;macros&#x2F;macros2.rs:7:5
  |
7 |     my_macro!();
  |     ^^^^^^^^
  |
  = help: have you added the `#[macro_use]` on the module&#x2F;import?

warning: unused macro definition: `my_macro`
  --&gt; exercises&#x2F;macros&#x2F;macros2.rs:10:14
   |
10 | macro_rules! my_macro {
   |              ^^^^^^^^
   |
   = note: `#[warn(unused_macros)]` on by default

error: aborting due to previous error; 1 warning emitted
</code></pre>
<p>We can see errors about not having the <code>#[macro_use]</code> module imported, but I'm not sure if that's exactly what is wrong here. Let's see if there's an easy way to solve this problem below.</p>
<h2 id="macros2-rs-solution">Macros2.rs Solution</h2>
<p>The solution is rather simple, we have to change the placement of the <code>macro_rules!</code> function an place it before the <code>fn main()</code>. The reason is that macro's don't abide by the same set of rules that the rest of Rust does, in the sense that order does matter. So you have to define a macro before you can use it. So simply declaring it before calling it, or in our case copy and pasting <code>my_macro</code> before <code>fn main()</code> and everything should work.</p>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">macro_rules! my_macro {
    () =&gt; {
        println!(&quot;Check out my macro!&quot;);
    };
}

fn main() {
    my_macro!();
}
</code></pre>
<p>It compiles and prints out the same message as before. So we're done here.</p>
<h2 id="macros3-rs">Macros3.rs</h2>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">&#x2F;&#x2F; macros3.rs
&#x2F;&#x2F; Make me compile, without taking the macro out of the module!
&#x2F;&#x2F; Execute `rustlings hint macros3` or use the `hint` watch subcommand for a hint.

&#x2F;&#x2F; I AM NOT DONE

mod macros {
    macro_rules! my_macro {
        () =&gt; {
            println!(&quot;Check out my macro!&quot;);
        };
    }
}

fn main() {
    my_macro!();
}
</code></pre>
<p>it looks like we have a very similar set of lines here with this exercise except that we have the <code>mod macros</code> encapsulating our <code>my_macro</code> definition.</p>
<h2 id="macros3-rs-errors">Macros3.rs Errors</h2>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">error: cannot find macro `my_macro` in this scope
  --&gt; exercises&#x2F;macros&#x2F;macros3.rs:16:5
   |
16 |     my_macro!();
   |     ^^^^^^^^
   |
   = help: have you added the `#[macro_use]` on the module&#x2F;import?

warning: unused macro definition: `my_macro`
 --&gt; exercises&#x2F;macros&#x2F;macros3.rs:8:18
  |
8 |     macro_rules! my_macro {
  |                  ^^^^^^^^
  |
  = note: `#[warn(unused_macros)]` on by default
</code></pre>
<p>So here we see the similar message about <code>#[macro_use]</code> but this time we might have a legitimate reason to use it.</p>
<h2 id="macros3-rs-solution">Macros3.rs Solution</h2>
<p>So since we have the <code>my_macro</code> macro wrapped in the <code>mod macro</code>  we nee to use the <code>#[macro_use]</code> to allow use of the macro outside of the module.</p>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">&#x2F;&#x2F; adding this line here
#[macro_use]
mod macros {
    macro_rules! my_macro {
        () =&gt; {
            println!(&quot;Check out my macro!&quot;);
        };
    }
}

fn main() {
    my_macro!();
}
</code></pre>
<p>Once again with this change we are compiling and printing <code>Check out my macro!</code> as before.</p>
<h2 id="macros4-rs">Macros4.rs</h2>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">&#x2F;&#x2F; macros4.rs
&#x2F;&#x2F; Execute `rustlings hint macros4` or use the `hint` watch subcommand for a hint.

&#x2F;&#x2F; I AM NOT DONE

#[rustfmt::skip]
macro_rules! my_macro {
    () =&gt; {
        println!(&quot;Check out my macro!&quot;);
    }
    ($val:expr) =&gt; {
        println!(&quot;Look at this other macro: {}&quot;, $val);
    }
}

fn main() {
    my_macro!();
    my_macro!(7777);
}
</code></pre>
<p>We see an expanded version of our macro that has an additional arm with that prints out a value if you give it one. But of course we're not compiling right now with how the code is constructed. So, let's look at the errors for any additional hints.</p>
<h2 id="macros4-rs-errors">Macros4.rs Errors</h2>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">‚ö†Ô∏è  Compiling of exercises&#x2F;macros&#x2F;macros4.rs failed! Please try again. Here&#x27;s the output:
error: no rules expected the token `(`
  --&gt; exercises&#x2F;macros&#x2F;macros4.rs:11:5
   |
11 |     ($val:expr) =&gt; {
   |     ^ no rules expected this token in macro call

error: aborting due to previous error
</code></pre>
<p>The error we're seeing is that it was expecting a token,  specifically the <code>(</code> but for some reason it's not seeing it. Typically when we're trying to compile our code when we see this type of error it is because we are missing something between our blocks of code. What could that be?</p>
<h2 id="macros4-rs-solution">Macros4.rs Solution</h2>
<p>This solution is again painfully simple all we need to do to get this to compile is properly separate the arms of the macro by adding <code>;</code> at the end of the first macro. This let's the Rust compiler know that we've ended the first arm of our macro so it then knows we have 2 different arms in the <code>my_macro</code> macro.</p>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">#[rustfmt::skip]
macro_rules! my_macro {
    () =&gt; {
        println!(&quot;Check out my macro!&quot;);
    };
    ($val:expr) =&gt; {
        println!(&quot;Look at this other macro: {}&quot;, $val);
    }
}

fn main() {
    my_macro!();
    my_macro!(7777);
}
</code></pre>
<p>with this we have our code compiling and printing:</p>
<pre data-lang="rust" class="language-rust "><code class="language-rust" data-lang="rust">‚úÖ Successfully ran exercises&#x2F;macros&#x2F;macros4.rs!

üéâ üéâ  The code is compiling! üéâ üéâ

Output:
====================
Check out my macro!
Look at this other macro: 7777

====================
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Working with macros in Rust can initially seem daunting due to their unique syntax and behavior. However, as we've seen in these exercises, common issues often have straightforward solutions once you understand how macros operate. Remember, macros are expanded at compile time, and their scope and definition order matter. By practicing with examples and understanding the error messages, you can become more comfortable with using and creating macros in Rust. They are a powerful tool in the Rust programmer's toolkit, enabling more expressive and flexible code. Keep experimenting and exploring the Rust documentation and community resources to deepen your understanding of macros and their capabilities in Rust programming.</p>

	</div>
	<hr class="post-end">
	<footer class="post-info">
    
	  <p>
		<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>
		
		
		<span class="tag"><a href="https://desmodrone.github.io/tags/rust/">rust</a></span>
		
		<span class="tag"><a href="https://desmodrone.github.io/tags/macros/">macros</a></span>
		
		<span class="tag"><a href="https://desmodrone.github.io/tags/rustlings/">rustlings</a></span>
		
		
    </p>
    
    <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1136 Words</p>
    
    <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2023-11-21</p>
    
	</footer>
  </article>
    
  
  <div class="post-nav thin">
	
	
  </div>

  
</main>

	  </div>
	  
	  



<footer id="site-footer" class="section-inner thin animated fadeIn faster">
  <p>&copy; 2024 <a href="https:&#x2F;&#x2F;desmodrone.github.io">erick</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
  <p>Made with <a href="https://www.getzola.org" target="_blank" rel="noopener">Zola</a> &#183; Theme <a href="https://github.com/VersBinarii/hermit_zola" target="_blank" rel="noopener">Hermit_Zola</a>
	
	&#183; <a href="https://desmodrone.github.io/rss.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
	
  </p>
</footer>




	</div>
	
	<script src="https://desmodrone.github.io/js/main.js"></script>

	<!-- Math rendering -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
        onload="renderMathInElement(document.body, { delimiters: [ {left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}, {left: '\\[', right: '\\]', display: true}, {left: '\\(', right: '\\)', display: false}]});"></script>

    
		<link href="https://unpkg.com/highlightjs-badge/highlightjs/styles/monokai.css" rel="stylesheet">
		<!-- https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.1/build/styles/  for min version -->
		<script src="https://unpkg.com/highlightjs-badge/highlightjs/highlight.pack.js"></script>
		<script src="https://unpkg.com/highlightjs-badge/highlightjs-badge.min.js"></script>
		<script>
			var pres = document.querySelectorAll("pre>code");
			for (var i = 0; i < pres.length; i++) {
				hljs.highlightBlock(pres[i]);
			}
		</script>
		
			<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>
			<script>
				var options = {
					copyIconClass: "gg-clipboard",
					checkIconClass: "gg-check"
				};
				window.highlightJsBadge(options);
			</script>
		

	

	
	<script src="https://desmodrone.github.io/js/main.js"></script>

    
    

	
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9MNTYXYNHK"></script>
    <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
     gtag('config', 'G-9MNTYXYNHK');
    </script>
    
  </body>
</html>
